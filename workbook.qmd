---
title: "Modelling inbreeding with care"
format: html
---

```{r}
#| message: false
#| warning: false
library(tidyverse)
library(stickylabeller) # labelling facets with strings in ggplot
library(rcartocolor) # for nice sequential colour schemes
library(ggtext)
library(patchwork)
```


## The framework

We can model whether inbreeding can invade an outbreeding population by counting the number of alleles that would be propagated by inbreeding individuals, compared to the number of alleles propagated if the individual were to instead outbreed. Let the average number of alleles propagated by an outbreeding female across her lifetime be $N_\mathrm{f}$, with the fraction $1/N_\mathrm{f}$ transmitted per effective mating. For an inbreeding female, the allele counting is more complex. Following Waser et al. (1986), let the number of alleles transmitted to offspring produced as a result of a single inbreeding event be $(1 - \delta)$, where $\delta$ represents inbreeding depression. Investment in this mating and subsequent reproduction (e.g. through parental care) may affect future reproductive output; let this cost be $\Delta N_\mathrm{f}$, such that future allele propagation is $N_\mathrm{f} - \Delta N_\mathrm{f}$. Finally, the number of allele copies indirectly propagated by the related male mating partner is $r(1 - \delta - \Delta N_\mathrm{m})$, where $r$ is the genealogical relatedness coefficient and $\Delta N_\mathrm{m}$ is the cost of male reproductive investment to his future allele propagation. Taken together, inbreeding is favoured for females when

$$(1 - \delta) + (N_\mathrm{f} - \Delta N_\mathrm{f}) + r(1 - \delta - \Delta N_\mathrm{m}) > N_\mathrm{f}, \qquad$$ {#eq-f_allele_counting}

and for males when

$$(1 - \delta) + (N_\mathrm{m} - \Delta N_\mathrm{m}) + r(1 - \delta - \Delta N_\mathrm{f}) > N_\mathrm{m}. \qquad$$ {#eq-m_allele_counting}

@eq-f_allele_counting and @eq-m_allele_counting can be rearranged to show that inbreeding is favoured by selection on females when:

$$\delta_\mathrm{f} < \frac{(1 -\Delta N_\mathrm{f}) + (r - r\Delta N_\mathrm{m})}{1 + r}$$ {#eq-f_D_tol}

and on males

$$\delta_\mathrm{m} < \frac{(1 -\Delta N_\mathrm{m}) + (r - r\Delta N_\mathrm{f})}{1 + r}$$ {#eq-f_D_tol}

If a round of reproduction following an inbred mating completely replaces the opportunity for an outbred round of reproduction in females ($\Delta N_\mathrm{f} = 1$), but has no effect on the future reproductive prospects of males ($\Delta N_\mathrm{f} = 0$) we recover $\delta_\mathrm{f} < \frac{r}{1 + r}$ and $\delta_\mathrm{m} < \frac{1}{1 + r}$, as previously found by Parker (1979).

## Adding an effect of care on $\delta$

If the costs to future reproduction $\Delta N_\mathrm{f}$ and $\Delta N_\mathrm{m}$ are primarily caused by investment in parental care, we can link this to the degree of inbreeding depression felt by offspring. Let $c = (\Delta N_\mathrm{f} + \Delta N_\mathrm{m})/2$, the amount of care received by offspring, averaged across parents. We assume that $c$ affects reproductive output following an inbreeding event by moderating inbreeding depression, such that direct fitness is $1-\delta(1-\alpha c)$, where $\alpha$ controls the effectiveness of care.

```{r}
#| message: false
#| warning: false
expand_grid(D = seq(from = 0, to = 1, by = 0.05),
            c = seq(from = 0, to = 1, by = 0.25),
            a = seq(from = 0, to = 1, by = 0.25)) %>% 
  mutate(fitness = 1 - D*(1-a*c) ) %>%
  #filter(c == 0) %>% 
  ggplot(aes(x = D, y = fitness, group = c, colour = c)) +
  geom_line(linewidth = 1.2) +
  scale_colour_carto_c(palette = "SunsetDark", type = "qualitative",
                       limits = c(0, 1)) +
  labs(y = "Reproductive output from current mating",
       x = "Inbreeding depression") +
  facet_wrap(~a, nrow = 2,
             scales = "free", strip.position = c("top"),
             labeller = label_glue('alpha = {`a`}')) +
  theme(axis.title = element_text(size = 16),
        legend.position = c(1, 0),
        legend.justification = c(1, 0))
```

Equations @eq-f_allele_counting and @eq-m_allele_counting become

$$[1-\delta(1-\alpha c)] + (N_\mathrm{f} - \Delta N_\mathrm{f}) + r[1 - \delta(1-\alpha c) - \Delta N_\mathrm{m}] > N_\mathrm{f}, \qquad$$ {#eq-f_allele_counting_pc}

$$[1-\delta(1-\alpha c)] + (N_\mathrm{m} - \Delta N_\mathrm{m}) + r[1 - \delta(1-\alpha c) - \Delta N_\mathrm{f}] > N_\mathrm{m}. \qquad$$ {#eq-m_allele_counting_pc}

In turn, the $\delta_\mathrm{f}$ and $\delta_\mathrm{m}$ inequalities become: 

$$\delta_\mathrm{f} < \frac{(1 -\Delta N_\mathrm{f}) + (r - r\Delta N_\mathrm{m})}{1 + r - \alpha c - r\alpha c},$$ {#eq-f_D_tol_pc}

$$\delta_\mathrm{m} < \frac{(1 -\Delta N_\mathrm{m}) + (r - r\Delta N_\mathrm{f})}{1 + r - \alpha c - r\alpha c}.$$ {#eq-m_D_tol_pc}

Thus, for both sexes non-zero care (that has some reducing effect on inbreeding depression) makes the denominator smaller, which increases the inbreeding depression threshold below which selection favours inbreeding. 

To explore this, lets set $\Delta N_\mathrm{f} = 1$ and $\Delta N_\mathrm{m} = 0$, which describes a monandrous mating system where only females provide care. Recall that $c = (\Delta N_\mathrm{f} + \Delta N_\mathrm{m}) / 2$, which when substituted into @eq-f_D_tol_pc and @eq-m_D_tol_pc gives

$$\delta_\mathrm{f} < \frac{r}{1 + r - \frac{\alpha}{2} - \frac{r\alpha}{2}},$$ 

$$\delta_\mathrm{m} < \frac{1}{1 + r - \frac{\alpha}{2} - \frac{r\alpha}{2}}.$$ 
We can plot these thresholds

```{r}
#| fig-width: 10
# females

parameters_f <- expand_grid(r = seq(from = 0, to = 1, by = 0.05),
                          delta = seq(from = 0, to = 1, by = 0.05),
                          a = c(0, 0.25, 0.5, 0.75, 1)) %>% 
  mutate(depression_threshold = r / (1 + r - 0.5*a - 0.5*r*a))

delta_f_plot <-
  parameters_f %>% 
  ggplot(aes(x = r, y = depression_threshold, group = a, colour = a)) +
  geom_line(linewidth = 1.4) + 
  coord_cartesian(ylim = c(0, 1)) +
  scale_colour_carto_c(palette = "SunsetDark", type = "qualitative",
                       limits = c(0, 1)) +
  labs(x = '_r_, the relatedness coefficient',
       y = ~delta~'(inbreeding depression in females)',
       ,
       colour = ~alpha~'') +
  #facet_wrap(~a) +
  scale_x_continuous(expand = c(0, 0.009)) + 
  scale_y_continuous(expand = c(0, 0)) +
  theme_bw() +
  theme(text = element_text(size = 14),
        axis.title.x = element_markdown())

# males

parameters_m <- expand_grid(r = seq(from = 0, to = 1, by = 0.05),
                          delta = seq(from = 0, to = 1, by = 0.05),
                          a = c(0, 0.25, 0.5, 0.75, 1)) %>% 
  mutate(depression_threshold = 1 / (1 + r - 0.5*a - 0.5*r*a))

delta_m_plot <-
  parameters_m %>% 
  ggplot(aes(x = r, y = depression_threshold, group = a, colour = a)) +
  geom_line(linewidth = 1.4) + 
  coord_cartesian(ylim = c(0, 1)) +
  scale_colour_carto_c(palette = "SunsetDark", type = "qualitative",
                       limits = c(0, 1)) +
  labs(x = '_r_, the relatedness coefficient',
       y = ~delta~'(inbreeding depression in males)',
       ,
       colour = ~alpha~'') +
  scale_x_continuous(expand = c(0, 0.009)) + 
  scale_y_continuous(expand = c(0, 0)) +
  theme_bw() +
  theme(text = element_text(size = 14),
        axis.title.x = element_markdown())

delta_f_plot + delta_m_plot + plot_layout(guides = "collect")
```

::: callout-tip
## Note
When $\alpha = 1$, selection will favour males that inbreed in all cases where inbreeding depression < 1. Hence, the corresponding purple line never appears on the figure.  
:::

Now, what happens when males care? Inspecting @eq-f_D_tol_pc and @eq-m_D_tol_pc reveals two, opposing effects. Increasing $\Delta N_\mathrm{m}$ decreases the size of the _numerator_, or put biologically, reduces a males future reproductive success. However it also leads to an increase in $c$, mitigating the effect of inbreeding depression on offspring production/survival and decreasing the size of the _denominator_. Whether inbreeding is favoured when males invest more in care depends on the $\alpha$ parameter. 

**Plot this tomorrow**



